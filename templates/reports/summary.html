{% extends 'base.html' %}
{% block content %}
<div class="grid grid-cols-1 md:grid-cols-3 gap-6">
  <div class="col-span-2 bg-white p-4 rounded shadow-sm">
    <h3 class="font-medium mb-3">Summary</h3>
    <div class="grid grid-cols-3 gap-3">
      <div class="p-4 bg-slate-50 rounded">
        <div class="text-xs text-slate-500">Total sales</div>
        <div class="text-xl font-semibold">₵{{ total_sales }}</div>
      </div>
      <div class="p-4 bg-slate-50 rounded">
        <div class="text-xs text-slate-500">Expenses</div>
        <div class="text-xl font-semibold">₵{{ total_expenses }}</div>
      </div>
      <div class="p-4 bg-slate-50 rounded">
        <div class="text-xs text-slate-500">Profit</div>
        <div class="text-xl font-semibold">₵{{ gross_profit }}</div>
      </div>
    </div>

    <div class="mt-6">
      <h4 class="font-medium mb-2">Sales vs Expenses (last 30 days)</h4>
      <canvas id="salesChart" width="800" height="300"></canvas>
    </div>

    <div class="mt-6">
      <h4 class="font-medium mb-2">Best selling</h4>
      <ul class="space-y-2">
        {% for b in best_selling %}
          <li class="flex justify-between">{{ b.product__name }} <span class="text-slate-600">{{ b.qty }}</span></li>
        {% empty %}
          <li class="text-slate-500">No sales yet</li>
        {% endfor %}
      </ul>
    </div>
  </div>

  <aside class="bg-white p-4 rounded shadow-sm">
    <h4 class="font-medium">Exports</h4>
    <div class="mt-3">
      <a href="{% url 'export_sales_csv' %}" class="block px-3 py-2 border rounded mb-2">Download sales CSV</a>
      <a href="{% url 'export_sales_excel' %}" class="block px-3 py-2 border rounded mb-2">Download sales Excel</a>
      <a href="{% url 'export_sales_pdf' %}" class="block px-3 py-2 border rounded mb-2">Download sales PDF</a>
    </div>
  </aside>
</div>

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  async function loadChart(){
    const resp = await fetch("{% url 'chart_sales_vs_expenses' %}");
    const data = await resp.json();
    const ctx = document.getElementById('salesChart').getContext('2d');
    new Chart(ctx, {
      type: 'line',
      data: {
        labels: data.labels,
        datasets: [
          { label: 'Sales', data: data.sales, tension: 0.3, fill: false },
          { label: 'Expenses', data: data.expenses, tension: 0.3, fill: false }
        ]
      },
      options: {
        responsive: true,
        interaction: {mode: 'index', intersect: false},
        scales: { y: { beginAtZero: true } }
      }
    });
  }
  loadChart();
</script>
{% endblock %}
